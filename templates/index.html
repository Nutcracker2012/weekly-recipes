<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>每周食谱计划</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>每周食谱计划</h1>
        </header>

        <main>
            <!-- Tabs Section -->
            <section class="card tabs-container">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="meal-plan">每周餐单</button>
                    <button class="tab-btn" data-tab="inventory">当前库存管理</button>
                    <button class="tab-btn" data-tab="dishes">菜品库</button>
                </div>

                <!-- Tab Content: Meal Plan -->
                <div id="meal-plan-tab" class="tab-content active">
                    <div class="form-group">
                        <label for="start-day">起始日期：</label>
                        <select id="start-day">
                            <option value="0">周日</option>
                            <option value="1">周一</option>
                            <option value="2">周二</option>
                            <option value="3">周三</option>
                            <option value="4">周四</option>
                            <option value="5">周五</option>
                            <option value="6">周六</option>
                        </select>
                        <button id="generate-plan-btn" class="btn btn-primary" style="margin-left: 10px;">生成餐单</button>
                        <button id="regenerate-plan-btn" class="btn btn-primary" style="margin-left: 10px; display: none;">重新生成餐单</button>
                    </div>
                    <div class="meal-plan-output" id="meal-plan-output" style="display: none;">
                        <div class="meal-plan-controls">
                            <input type="text" id="meal-plan-name" placeholder="输入餐单名称（例如：一周晚餐）" style="flex: 1; max-width: 300px;">
                            <button id="edit-plan-btn" class="btn btn-secondary" style="margin-left: 10px;">编辑餐单</button>
                            <button id="save-plan-btn" class="btn btn-primary" style="margin-left: 10px; display: none;">保存餐单</button>
                            <button id="cancel-edit-btn" class="btn btn-secondary" style="margin-left: 10px; display: none;">取消编辑</button>
                        </div>
                        <div id="meal-plan-display"></div>
                    </div>
                    <div id="meal-plan-hint" style="margin-top: 15px; display: none;">
                        <p><strong>提示：</strong>点击"编辑餐单"可以修改菜名、删除菜品或添加新菜品。编辑完成后点击"保存餐单"。</p>
                    </div>
                </div>

                <!-- Tab Content: Inventory Management -->
                <div id="inventory-tab" class="tab-content">
                    <div class="inventory-controls">
                        <button id="add-inventory-btn" class="btn btn-secondary">手动添加库存</button>
                        <button id="paste-weee-btn" class="btn btn-secondary">粘贴 Weee 购买文本：</button>
                        <button id="load-inventory-btn" class="btn btn-secondary">刷新库存</button>
                    </div>
                    <div class="table-container">
                        <table id="current-inventory-table">
                            <thead>
                                <tr>
                                    <th>食材名称</th>
                                    <th>数量</th>
                                    <th>单位</th>
                                    <th>类别</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="current-inventory-tbody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab Content: Dish Library -->
                <div id="dishes-tab" class="tab-content">
                    <div class="dish-controls">
                        <button id="add-dish-btn" class="btn btn-secondary">添加菜品</button>
                    </div>
                    <div class="table-container">
                        <table id="dishes-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>名称</th>
                                    <th>类别</th>
                                    <th>食材</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="dishes-tbody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Past Meals Section -->
            <section class="card">
                <h2>最近餐单记录</h2>
                <div class="table-container">
                    <table id="past-meals-table">
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>菜品</th>
                            </tr>
                        </thead>
                        <tbody id="past-meals-tbody">
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Add/Edit Dish Modal -->
    <div id="dish-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-title">添加菜品</h2>
            <form id="dish-form">
                <input type="hidden" id="dish-id">
                <div class="form-group">
                    <label for="dish-name">菜品名称：</label>
                    <input type="text" id="dish-name" required>
                </div>
                <div class="form-group">
                    <label for="dish-category">类别：</label>
                    <select id="dish-category" required>
                        <option value="肉类">肉类</option>
                        <option value="海鲜">海鲜</option>
                        <option value="蔬菜">蔬菜</option>
                        <option value="豆类">豆类</option>
                        <option value="蛋类">蛋类</option>
                        <option value="主食">主食</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="dish-ingredients">食材（用逗号分隔）：</label>
                    <input type="text" id="dish-ingredients" placeholder="鸡肉, 花生" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">保存</button>
                    <button type="button" class="btn btn-secondary" id="cancel-btn">取消</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Inventory Modal -->
    <div id="inventory-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-inventory">&times;</span>
            <h2 id="inventory-modal-title">添加库存</h2>
            <form id="inventory-form">
                <input type="hidden" id="inventory-item-name-original">
                <div class="form-group">
                    <label for="inventory-item-name">食材名称：</label>
                    <input type="text" id="inventory-item-name" required>
                </div>
                <div class="form-group">
                    <label for="inventory-quantity">数量：</label>
                    <input type="number" id="inventory-quantity" step="0.1" min="0" required>
                </div>
                <div class="form-group">
                    <label for="inventory-unit">单位：</label>
                    <input type="text" id="inventory-unit" placeholder="磅, 克, 个, 把" required>
                </div>
                <div class="form-group">
                    <label for="inventory-category">类别：</label>
                    <select id="inventory-category">
                        <option value="肉类">肉类</option>
                        <option value="海鲜">海鲜</option>
                        <option value="蔬菜">蔬菜</option>
                        <option value="豆制品">豆制品</option>
                        <option value="蛋类">蛋类</option>
                        <option value="主食">主食</option>
                        <option value="调料">调料</option>
                        <option value="其他">其他</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">保存</button>
                    <button type="button" class="btn btn-secondary" id="cancel-inventory-btn">取消</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mark Cooked Modal -->
    <div id="mark-cooked-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <span class="close-mark-cooked">&times;</span>
            <h2 id="mark-cooked-modal-title">标记为已做</h2>
            <div id="mark-cooked-modal-body"></div>
            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="confirmMarkCooked()">确认</button>
                <button type="button" class="btn btn-secondary" id="cancel-mark-cooked-btn">取消</button>
            </div>
        </div>
    </div>

    <!-- Weee Import Modal -->
    <div id="weee-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <span class="close-weee">&times;</span>
            <h2>导入 Weee 购买记录</h2>
            
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">粘贴文本</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">预览确认</div>
                </div>
            </div>

            <!-- Step 1: Paste Text -->
            <div id="weee-step-1" class="weee-step active">
                <div class="form-group">
                    <label for="weee-text">粘贴 Weee 购买文本：</label>
                    <textarea id="weee-text" rows="8" placeholder="weee_牧民人家 奶疙瘩 原味 400 克&#10;单价: $5.79 |数量: 1&#10;..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="weee-parse-btn">解析库存</button>
                    <button type="button" class="btn btn-secondary" id="weee-cancel-btn">取消</button>
                </div>
            </div>

            <!-- Step 2: Preview and Edit -->
            <div id="weee-step-2" class="weee-step" style="display: none;">
                <p class="preview-hint">请检查并修改以下库存项目，确认无误后点击"确认添加"：</p>
                <div class="table-container">
                    <table id="weee-preview-table">
                        <thead>
                            <tr>
                                <th>食材名称</th>
                                <th>数量</th>
                                <th>单位</th>
                                <th>类别</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="weee-preview-tbody">
                        </tbody>
                    </table>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="weee-confirm-btn">确认添加</button>
                    <button type="button" class="btn btn-secondary" id="weee-back-btn">返回</button>
                    <button type="button" class="btn btn-secondary" id="weee-cancel-step2-btn">取消</button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
